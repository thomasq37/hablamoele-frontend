<div class="loader-container" *ngIf="isLoading">
  <div class="container">
    <!--
        <h2>Recursos para profesores</h2>
    -->
    <span class="loader"></span>
  </div>
</div>

<!-- Contenu principal une fois chargé -->
<section id="recursos" *ngIf="!isLoading && recursos.length > 0">
  <div class="container">
    <!--
        <h2>Recursos para profesores</h2>
    -->

    <div class="filters">
      <!-- Groupe Niveles -->
      <div class="filter-group" *ngIf="niveles.length > 0">
        <span class="filter-group__label">Niveles</span>
        <ul class="filter-group__list">
          <li class="filter-group__item">
            <button
              type="button"
              class="filter-chip"
              [class.is-active]="selectedNivelIds.size === 0"
              [attr.aria-pressed]="selectedNivelIds.size === 0 ? 'true' : 'false'"
              title="Mostrar todos los niveles">
              Todos
            </button>
          </li>
          <li class="filter-group__item" *ngFor="let nivel of niveles;">
            <button
              type="button"
              class="filter-chip"
              [class.is-active]="selectedNivelIds.has(nivel.id!)"
              (click)="naviuerARecursos()"
              [attr.aria-pressed]="selectedNivelIds.has(nivel.id!)">
              {{ nivel.nombre }}
            </button>
          </li>
        </ul>
      </div>

      <!-- Groupe Categorías -->
      <div class="filter-group" *ngIf="categorias.length > 0">
        <span class="filter-group__label">Categorías</span>
        <ul class="filter-group__list">
          <li class="filter-group__item">
            <button
              type="button"
              class="filter-chip"
              [class.is-active]="selectedCategoriaIds.size === 0"
              [attr.aria-pressed]="selectedCategoriaIds.size === 0 ? 'true' : 'false'"
              title="Mostrar todas las categorías">
              Todas
            </button>
          </li>
          <li class="filter-group__item" *ngFor="let categoria of categorias;">
            <button
              type="button"
              class="filter-chip"
              [class.is-active]="selectedCategoriaIds.has(categoria.id!)"
              (click)="naviuerARecursos()"
              [attr.aria-pressed]="selectedCategoriaIds.has(categoria.id!)">
              {{ categoria.nombre }}
            </button>
          </li>
        </ul>
      </div>

      <!-- Actions -->
    </div>

    <!-- Liste filtrée -->
    <ul class="recursos-liste">
      <li *ngFor="let recurso of recursos"
          class="card"
          [class.downloading]="isDownloading(recurso.id)"
          [class.disabled]="isDownloading(recurso.id)"
          (click)="!isDownloading(recurso.id) && onDescargar(recurso)"
          [style.pointer-events]="isDownloading(recurso.id) ? 'none' : 'auto'"
          [style.opacity]="isDownloading(recurso.id) ? '0.7' : '1'">

        <img
          class="recursos-banner"
          [src]="'data:image/png;base64,' + recurso.banner"
          [alt]="recurso.titulo || 'Banner del recurso'"
        />

        <div class="card-contenu">
          <ul class="recurso-niveles">
            <li [style.background-color]="nivel.color"  *ngFor="let nivel of recurso.niveles">
              <span>{{ nivel.nombre }}</span>
            </li>
          </ul>
          <h3>{{ recurso.titulo }}</h3>
          <p class="description">{{ recurso.description }}</p>
          <ul class="recurso-nb-contenus">
            <li *ngIf="recurso.nbInfografias > 0">
              <span>{{ recurso.nbInfografias }} infografía{{recurso.nbInfografias > 1 ? 's' : ''}}</span>
            </li>
            <li *ngIf="recurso.nbCahiersActivite > 0">
              <span>{{ recurso.nbCahiersActivite }} cuaderno{{recurso.nbCahiersActivite > 1 ? 's' : ''}} de actividades</span>
            </li>
          </ul>
          <ul class="recurso-tags">
            <li class="tag" *ngFor="let tag of (recurso.tags ? recurso.tags.split(',') : [])">
              {{ tag.trim() }}
            </li>
          </ul>
        </div>

        <div class="button-container">
          <button
            class="recursos-infografias-descargar"
            [disabled]="isDownloading(recurso.id)"
            [class.downloading]="isDownloading(recurso.id)">
            {{ getDownloadButtonText(recurso) }}
          </button>
        </div>

      </li>
    </ul>
    <div (click)="naviuerARecursos()" class="container-button-ver-mas">
      <button >Ver mas</button>
    </div>
  </div>
</section>
